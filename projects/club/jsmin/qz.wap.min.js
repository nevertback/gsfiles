"use strict";!function(){var a="http://j.gamersky.com/user/club/wap/data/fake.data.pg2.js",t="http://j.gamersky.com/user/club/wap/data/fake.comm.pg2.js",e="http://j.gamersky.com/user/club/wap/data/fake.like.pg2.js",i="http://j.gamersky.com/user/club/wap/data/fake.alltopic.pg2.js",o={isCanLoading:!0,loadingDom:'<div class="qz-loading">正在加载</div>',loadedDom:'<div class="qz-loaded">全部加载完成</div>',loadnullDom:'<div class="qz-loadnull">还没有内容</div>'},n={setRem:function(){var a=$(window).width();a>=640&&(a=640),$("html").css({"font-size":a/6.4+"px"})},createCard:function(a){var t="";return t+='<div class="qz-card qzCard" data-cid="'+a.cardid+'">',t+='<header><a class="head"><img src="'+a.head+'" alt="head"></a>',t+='<div class="info"><h5>',t+="<a>"+a.user+"</a>",a.vauth===!0&&(t+='<i class="member member-v1"></i>'),a.editauth===!0&&(t+='<i class="member member-v2"></i>'),t+="</h5><p>",t+='<span class="time">'+a.createtime+"</span>",t+="</p>",t+="</div>",a.spectop!==!0&&a.specvalue!==!0||(t+='<div class="spec-icons">',a.spectop===!0&&(t+='<a class="spec-top">置顶</a>'),a.specvalue===!0&&(t+='<a class="spec-value">精</a>'),t+="</div>"),t+="</header>",t+='<section class="detail qzZoneHref" data-href="'+a.url+'">',t+='<div class="content">'+a.text+"</div>",a.piclist&&(t+='<div class="media-pic-list"><div class="clearfix qz-figs qzPicPswp">',$.each(a.piclist,function(a,e){t+='<figure class="qzPicPswpBtn',"gif"===e.ext?t+=' gif"':"long"===e.ext&&(t+=' long"'),t+='"><a data-origin="http://www.gamersky.com/showimage/id_gamersky.shtml?'+e.origin+'"  data-large="'+e.large+'" data-size="'+e.size+'"><img src="'+e.url+'"></a></figure>'}),t+="</div></div>"),a.picbig&&(t+='<div class="qzPicPswp media-pic"><figure class="',"gif"===a.picbig.ext?t+=" gif":"long"===a.picbig.ext&&(t+=" long"),t+='"><a data-origin="http://www.gamersky.com/showimage/id_gamersky.shtml?'+a.picbig.origin+'" data-large="'+a.picbig.large+'" data-size="'+a.picbig.size+'"><img src="'+a.picbig.url+'" class="qzPicPswpBtn"></a></figure></div>'),a.video&&(t+='<div class="media-video',t+='"><a class="qzVideoPopBtn" data-href="'+a.video.src+'"><img src="'+a.video.pic+'" alt=""></a></div>'),t+="</section>",a.fromUrl&&(t+='<div class="from">来自：<a href="'+a.fromUrl+'">'+a.from+"</a></div>"),t+="<footer>",t+='<a class="btn-like qzBtnLike" data-likecount="'+a.countlike+'"><i></i><b>'+a.countlike+"</b></a><span></span>",t+='<a class="btn-comment qzBtnComment" data-commcount="'+a.countcomment+'" data-commid="'+a.cardid+'"  data-href="'+a.url+'">'+a.countcomment+"</a>",t+="</footer>",t+="</div>",t+="",t+=""},addSwpOnce:function(){var a='<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button><a class="pswp__button pswpBtnOrigin pswp__single-tap" title="查看原图"></a> <button class="pswp__button pswp__button--share" title="Share"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div>';$("body").append(a)},photoSwp:function(){var a=function(a){for(var t=function(a){for(var t,e,i,o,n=a.childNodes,d=n.length,l=[],s=0;s<d;s++)t=n[s],1===t.nodeType&&(e=t.children[0],i=e.getAttribute("data-size").split("x"),o={src:e.getAttribute("data-large"),w:parseInt(i[0],10),h:parseInt(i[1],10),ori:e.getAttribute("data-origin")},t.children.length>1&&(o.title=t.children[1].innerHTML),e.children.length>0&&(o.msrc=e.children[0].getAttribute("src")),o.el=t,l.push(o));return l},e=function s(a,t){return a&&(t(a)?a:s(a.parentNode,t))},i=function(a){a=a||window.event,a.preventDefault?a.preventDefault():a.returnValue=!1;var t=a.target||a.srcElement,i=e(t,function(a){return a.tagName&&"FIGURE"===a.tagName.toUpperCase()});if(i){for(var n,d=i.parentNode,l=i.parentNode.childNodes,s=l.length,c=0,r=0;r<s;r++)if(1===l[r].nodeType){if(l[r]===i){n=c;break}c++}return n>=0&&o(n,d),!1}},o=function(a,e,i,o){function n(a){$(".pswpBtnOrigin").attr("href",s[a].ori)}var d,l,s,c=$(".pswp")[0];if(s=t(e),l={shareEl:!1,fullscreenEl:!1,zoomEl:!1,bgOpacity:1,showHideOpacity:0,galleryUID:e.getAttribute("data-pswp-uid"),history:!1,getThumbBoundsFn:function(a){var t=s[a].el.getElementsByTagName("img")[0],e=window.pageYOffset||document.documentElement.scrollTop,i=t.getBoundingClientRect();return{x:i.left,y:i.top+e,w:i.width}}},o)if(l.galleryPIDs){for(var r=0;r<s.length;r++)if(s[r].pid==a){l.index=r;break}}else l.index=parseInt(a,10)-1;else l.index=parseInt(a,10);isNaN(l.index)||(i&&(l.showAnimationDuration=0),d=new PhotoSwipe(c,PhotoSwipeUI_Default,s,l),d.init(),d.listen("initialZoomIn",function(){n(d.getCurrentIndex()),$(".pswp").animate({opacity:1},333)}),d.listen("initialZoomOut",function(){$(".pswp").animate({opacity:0},200)}),d.listen("afterChange",function(){n(d.getCurrentIndex())}))},n=document.querySelectorAll(a),d=0,l=n.length;d<l;d++)n[d].setAttribute("data-pswp-uid",d+1),n[d].onclick=i};a(".qzPicPswp")},insertCard:function(a,t){var e="";$.each(t,function(a,t){e+=n.createCard(t)}),$(a).html(e),n.photoSwp(),n.openVideoPop()},appendCard:function(a,t){var e="";$.each(t,function(a,t){e+=n.createCard(t)}),$(a).append(e),n.photoSwp(),n.openVideoPop()},addContext:function(){function a(a){function t(){o.find(".realIpt").on("input",function(){o.find(".mathIpt").val(o.find(".realIpt").val());var a=o.find(".mathIpt")[0].scrollHeight;o.find(".realIpt").css("height",a)})}function e(){o.removeClass("cur"),$("html,body").removeClass("hideScroll").animate({scrollTop:a},0),setTimeout(function(){o.remove()},250)}var i="";i+='<div class="qz-pop qzPop">',i+='<header>发布内容<a class="qz-pop-close qzPopClose"></a><a class="qz-pop-smt qzPopSmt">发布</a></header>',i+='<div class="pop-con">',i+='<div class="pop-srl"><textarea class="realIpt" placeholder="分享你的游戏心得..."></textarea><textarea class="mathIpt" rows="3"></textarea></div>',i+='<div class="clearfix qz-pic-list">',i+='<div class="qz-pic-list-li"><img src="http://imgs.gamersky.com/pic/2017/20171102_zy_164_666.jpg"><a class="qz-img-remove"></a></div>',i+='<div class="qz-pic-list-li"><img src="http://img1.gamersky.com/image2017/11/20171105_gtz_412_2/gamersky_04origin_07_2017115106F5F.jpg"><a class="qz-img-remove"></a></div>',i+='<div class="qz-pic-list-li"><img src="http://img1.gamersky.com/image2017/11/20171105_gtz_412_1/gamersky_02small_04_20171159476F0.jpg"><a class="qz-img-remove"></a></div>',i+='<div class="qz-pic-list-li"><img src="http://img1.gamersky.com/image2017/11/20171105_gtz_412_1/gamersky_03small_06_2017115947DAC.jpg"><a class="qz-img-remove"></a></div>',i+='<div class="qz-pic-list-li"><img src="http://img1.gamersky.com/image2017/11/20171105_gtz_412_1/gamersky_01small_02_2017115947F5B.jpg"><a class="qz-img-remove"></a></div>',i+='<div class="qz-pic-list-li"><label for="qzSelectPhoto" class="qz-pic-list-add"></label></div>',i+="</div>",i+="</div>",i+='<footer><label for="qzSelectPhoto" class="qz-upload-pic qzUploadPic">图片</label><select class="qz-pop-sel">',i+='<option value="">发往圈子</option>',i+='<option value="">发往gamersky</option>',i+='<option value="">发往游民之家</option>',i+='<option value="">发往圈子3</option>',i+="</select>",i+='<input id="qzSelectPhoto" class="qz-select-photo" type="file" accept="image/gif,image/jpeg,image/jpg,image/png,image/bmp">',i+="</footer></div>",$("body").append(i);var o=$(".qzPop");setTimeout(function(){o.addClass("cur")},10),t(),$(".qzPopClose").on("click",e),$(".qzPopSmt").on("click",function(){var a=o.find(".realIpt").val();console.log("发布成功:"+a),e()})}$("#qzMain").on("click",".qzBtnContext",function(){var t=$("html").scrollTop();0===t&&(t=$("body").scrollTop()),setTimeout(function(){$("html,body").addClass("hideScroll")},300),a(t)})},addComment:function(){function a(a,t,e){function i(){l.find(".realIpt").on("input",function(){l.find(".mathIpt").val(l.find(".realIpt").val());var a=l.find(".mathIpt")[0].scrollHeight;l.find(".realIpt").css("height",a)})}function o(){l.removeClass("cur"),$("html,body").removeClass("hideScroll").animate({scrollTop:a},0),setTimeout(function(){l.remove()},250)}var n="",d=e?"回复 "+e+"：":"我来说两句...";n+='<div class="qz-pop qzPop">',n+='<header>评论<a class="qz-pop-close qzPopClose"></a><a class="qz-pop-smt qzPopSmt">发布</a></header>',n+='<div class="pop-con"><div class="pop-srl"><textarea class="realIpt" placeholder="'+d+'"></textarea><textarea class="mathIpt" rows="3"></textarea></div></div>',n+="</div>",$("body").append(n);var l=$(".qzPop");setTimeout(function(){l.addClass("cur")},10),i(),console.log("给 cid = "+t+" 评论添加评论 *** cid 为按钮传入的评论卡片id,供开发使用"),$(".qzPopClose").on("click",o),$(".qzPopSmt").on("click",function(){var a=l.find(".realIpt").val();console.log("cid:"+t+",发布成功:"+a),o()})}$("#qzMain").on("click",".qzBtnComment",function(){var t=$("html").scrollTop(),e=$(this),i=e.data("commid"),o=e.data("commcount"),n=e.data("href"),d=e.attr("data-name");return $("#qzCardContext").length>0?(0===t&&(t=$("body").scrollTop()),setTimeout(function(){$("html,body").addClass("hideScroll")},300),a(t,i,d),!1):void(0===o?(0===t&&(t=$("body").scrollTop()),setTimeout(function(){$("html,body").addClass("hideScroll")},300),a(t,i)):window.open(n,"_blank"))})},addLike:function(){$("#qzMain").on("click",".qzBtnLike",function(){var a=$(this),t=a.closest(".qzCard").data("cid"),e=a.attr("data-likecount");1===parseInt(a.attr("data-islike"))?(a.removeClass("cur").attr("data-islike","0").attr("data-likecount",parseInt(e)-1).find("b").html(parseInt(e)-1),console.log("删除赞")):(a.addClass("cur").attr("data-islike","1").attr("data-likecount",parseInt(e)+1).find("b").html(parseInt(e)+1),console.log("喜欢了 cid = "+t+" 的卡片 *** cid 为按钮传入的卡片id,供开发使用"))})},initPage:function(){var a="#qzCardList",t=$(a);if(t.length>0){var e=t.data("from");$.ajax({dataType:"Script",url:e,beforeSend:function(){t.append(o.loadingDom)},success:function(){"ok"===fakeDate.dataType?(t.attr("data-page",fakeDate.page),t.attr("data-infiload","open"),n.insertCard(a,fakeDate.cardgroup)):t.html(o.loadnullDom)}})}},initPageTopic:function(){var a="#qzCardListTopic",t=$(a);if(t.length>0){var e=t.data("from");$.ajax({dataType:"Script",url:e,beforeSend:function(){t.append(o.loadingDom)},success:function(){"ok"===fakeDate.dataType?(t.attr("data-page",fakeDate.page),t.attr("data-moreload","open"),n.insertCard(a,fakeDate.cardgroup)):t.html(o.loadnullDom)}})}},initPageContext:function(){var a="#qzCardContext",i=$(a);if(i.length>0){var d=function(){function i(){var a,i,d=$(".qzClCon.cur").attr("id");"qzClComment"===d?(a="#qzClComment",i=$(a),"open"===i.attr("data-infiload")?$.ajax({dataType:"Script",url:t,beforeSend:function(){i.append(o.loadingDom)},success:function(){var t=i.attr("data-page"),e=fakeCommData.page;i.find(".qz-loading").remove(),e>t?(i.attr("data-page",e),n.appendCardComment(a,fakeCommData.commlist)):"open"===i.attr("data-infiload")&&(i.attr("data-infiload","close"),i.append(o.loadedDom)),o.isCanLoading=!0}}):o.isCanLoading=!0):"qzClLike"===d&&(a="#qzClLike",i=$(a),"open"===i.attr("data-infiload")?$.ajax({dataType:"Script",url:e,beforeSend:function(){i.append(o.loadingDom)},success:function(){var t=i.attr("data-page"),e=fakeLikeData.page;i.find(".qz-loading").remove(),e>t?(i.attr("data-page",e),n.appendCardLike(a,fakeLikeData.likelist)):"open"===i.attr("data-infiload")&&(i.attr("data-infiload","close"),i.append(o.loadedDom)),o.isCanLoading=!0}}):o.isCanLoading=!0)}function d(){var a=$("html").scrollTop(),t=$(document).height(),e=$(window).height();0===a&&(a=$("body").scrollTop()),a>t-e-20&&a>e-t&&o.isCanLoading===!0&&(o.isCanLoading=!1,i())}$(a).length>0&&$(window).scroll(function(){d()})},l=i.data("from");$.ajax({dataType:"Script",url:l,beforeSend:function(){i.append(o.loadingDom)},success:function(){"ok"===fakeDate.dataType?(i.attr("data-page",fakeDate.page),n.insertCard(a,fakeDate.cardgroup)):i.html(o.loadnullDom)}});var s="#qzClComment",c=$(s).data("from");$.ajax({dataType:"Script",url:c,beforeSend:function(){$(s).append(o.loadingDom)},success:function(){"ok"===fakeCommData.dataType?($(s).attr("data-page",fakeCommData.page),$(s).attr("data-infiload","open"),n.insertCardComment(s,fakeCommData.commlist)):$(s).html(o.loadnullDom)}}),d()}},infiniteLoad:function(a,t){function e(){var e=$(a);"open"===e.attr("data-infiload")&&"function"==typeof t&&t(a,e)}function i(){var a=$("html").scrollTop(),t=$(document).height(),i=$(window).height();0===a&&(a=$("body").scrollTop()),a>t-i-20&&a>i-t&&o.isCanLoading===!0&&(o.isCanLoading=!1,e())}$(a).length>0&&$(window).scroll(function(){i()})},topicMore:function(){var t=$(".qzCardMoreBtn");t.on("click",function(){var e=$("#qzCardListTopic");e.length>0&&"open"===e.attr("data-moreload")&&$.ajax({dataType:"Script",url:a,beforeSend:function(){e.append(o.loadingDom)},success:function(){var a=e.attr("data-page"),i=fakeDate.page;e.find(".qz-loading").remove(),i>a?(e.attr("data-page",i),n.appendCard("#qzCardListTopic",fakeDate.cardgroup)):"open"===e.attr("data-moreload")&&(e.attr("data-moreload","close"),t.html("全部加载完成"))}})})},tabNav:function(){function a(){function a(){var a=s.offset().top,t=$("html").scrollTop();0===t&&(t=$("body").scrollTop()),t>=a?l.addClass("openQzNavFixed"):l.removeClass("openQzNavFixed")}function t(){var a=$("html"),t=a.height(),e=s.offset().top,i=a.scrollTop();0===i&&(i=$("body").scrollTop()),a.css("height",t),i>e&&$("html,body").animate({scrollTop:e},0)}function e(){var a=$("html");clearTimeout(i),i=setTimeout(function(){a.css("height","")},200)}var i,d=$(".qzNavFx"),l=$(".qzNavFxW"),s=$(".qzNavPos");a(),$(window).scroll(function(){a()}),d.find("a").on("click",function(){var a=$(this),i=a.data("from"),l="#qzCardList";d.find("a").removeClass("cur"),a.addClass("cur"),$.ajax({dataType:"Script",url:i,beforeSend:function(){t(),o.isCanLoading=!1,$(l).html(o.loadingDom)},success:function(){o.isCanLoading=!0,"ok"===fakeDate.dataType?($(l).attr("data-page",fakeDate.page),$(l).attr("data-infiload","open"),n.insertCard(l,fakeDate.cardgroup)):$(l).html(o.loadnullDom),e()}})})}$(".qzNavFx").length>0&&a()},tabCl:function(){var a=$(".tabNavCl"),t=$(".qzClCon");a.find("a").on("click",function(){var e=$(this),i=e.data("tar");if(a.find("a").removeClass("cur"),t.removeClass("cur"),e.addClass("cur"),$("."+i).addClass("cur"),"qzClLike"===i){var d="#qzClLike",l=$(d).data("from");void 0===$(d).attr("data-page")&&$.ajax({dataType:"Script",url:l,beforeSend:function(){$(d).append(o.loadingDom)},success:function(){$(d).find(".qz-loading").remove(),"ok"===fakeLikeData.dataType?($(d).attr("data-page",fakeLikeData.page),$(d).attr("data-infiload","open"),n.appendCardLike(d,fakeLikeData.likelist)):$(commtar).html(o.loadnullDom)}})}})},pageGoto:function(){var a=$(".qz-card-list");a.on("click",".qzCard .qzZoneHref",function(){var a=$(this),t=a.data("href");window.open(t,"_blank")}),a.on("click",".qzZoneHref figure,.qzZoneHref a",function(a){a.stopPropagation()})},createCardComment:function(a){var t="";return t+='<li data-commid="'+a.commid+'"><a class="head">',t+='<img src="'+a.head+'" alt="'+a.name+'"></a>',t+='<div class="info qzBtnComment" data-commid="'+a.commid+'" data-name="'+a.name+'">',t+="<h5>"+a.name,a.reply&&(t+="<b>回复</b>"+a.reply),t+="</h5>",t+='<p class="time">'+a.replytime+"</p>",t+='<div class="context">',t+=a.context,t+="</div></div></li>"},insertCardComment:function(a,t){var e="";$.each(t,function(a,t){e+=n.createCardComment(t)}),$(a).html(e)},appendCardComment:function(a,t){var e="";$.each(t,function(a,t){e+=n.createCardComment(t)}),$(a).append(e)},createCardLike:function(a){var t="";return t+='<li data-likeid="'+a.likeid+'"><a class="head">',t+='<img src="'+a.head+'" alt="'+a.name+'"></a>',t+='<div class="name"><a>'+a.name+"</a></div>",t+="</div></li>"},insertCardLike:function(a,t){var e="";$.each(t,function(a,t){e+=n.createCardLike(t)}),$(a).html(e)},appendCardLike:function(a,t){var e="";$.each(t,function(a,t){e+=n.createCardLike(t)}),$(a).append(e)},openVideoPop:function(){function a(a){function t(){i.removeClass("cur"),setTimeout(function(){i.remove()},250)}var e="";e+='<div class="qz-video-pop qzVideoPop">',e+='<div class="qz-video-pop-con">',e+='<iframe height="100%" width="100%" src="http://player.youku.com/embed/'+a+'" frameborder=0 allowfullscreen></iframe>',e+="</div>",e+='<div class="qz-video-bar"><a class="qz-video-pop-close qzVideoPopClose"></div></a>',e+="</div>",$("body").append(e);var i=$(".qzVideoPop");setTimeout(function(){i.addClass("cur")},10),i.on("click",t),i.on("click","iframe",function(a){a.stopPropagation()})}$(".qzVideoPopBtn").on("click",function(){var t=$(this),e=t.data("href"),i="",o="http://v.youku.com/v_show/id_",n=e.indexOf(o)+o.length,d=e.indexOf("==.html");i=e.substring(n,d),a(i)})},createAllTopic:function(a){var t="";return t+='<li data-topicid="'+a.id+'"><a href="'+a.url+'"><b>#'+a.title+'#</b><span><i class="num-in">'+a.countjoin+'</i>人参与<i class="num-comm">'+a.countcomm+"</i>条讨论</span></a></li>"},allTopic:function(){function a(a){var t="";$.each(a,function(a,e){t+=n.createAllTopic(e)}),d.html(t)}function t(a){var t="";$.each(a,function(a,e){t+=n.createAllTopic(e)}),d.append(t)}function e(){var t=d.data("from");$.ajax({dataType:"script",url:t,success:function(){var t=fakeAlltopic;d.attr({"data-page":t.page,"data-infiload":"open"}),a(t.topiclist)}})}var d=$("#qzAllTopicList");d.length>0&&(e(),n.infiniteLoad("#qzAllTopicList",function(a,e){var n=$("#qzMain");$.ajax({dataType:"Script",url:i,beforeSend:function(){n.append(o.loadingDom)},success:function(){var a=e.attr("data-page"),i=fakeAlltopic.page;n.find(".qz-loading").remove(),i>a?(e.attr("data-page",i),t(fakeAlltopic.topiclist)):"open"===e.attr("data-infiload")&&(e.attr("data-infiload","close"),n.append(o.loadedDom)),o.isCanLoading=!0}})}))},main:function(){n.setRem(),n.addSwpOnce(),n.addComment(),n.addLike(),n.addContext(),n.initPage(),n.initPageTopic(),n.initPageContext(),n.tabNav(),n.infiniteLoad("#qzCardList",function(t,e){$.ajax({dataType:"Script",url:a,beforeSend:function(){e.append(o.loadingDom)},success:function(){var a=e.attr("data-page"),i=fakeDate.page;e.find(".qz-loading").remove(),i>a?(e.attr("data-page",i),n.appendCard(t,fakeDate.cardgroup)):"open"===e.attr("data-infiload")&&(e.attr("data-infiload","close"),e.append(o.loadedDom)),o.isCanLoading=!0}})}),n.topicMore(),n.tabCl(),n.pageGoto(),n.allTopic(),$(window).resize(function(){n.setRem()})}};n.main()}();
//# sourceMappingURL=qz.wap.min.js.map
